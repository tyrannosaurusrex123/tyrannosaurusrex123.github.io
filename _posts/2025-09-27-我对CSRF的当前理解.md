---
title: "我对CSRF的当前理解"
date: 2025-09-27
categories: [csrf]


---

## 针对CSRF的提问：



#### 1.什么是CSRF？

- 跨站请求伪造：从第三方网站向目标网站发送请求，如果被攻击者登陆过目标网站，浏览器会带上cookie，从而通过目标网站的权限验证然后执行目标操作

#### 2.浏览器在什么情况下会自动带上cookie，什么时候不会？

- 在JS环境中执行脚本时（如：`XMLHttpRequest`，`Fetch`等需要JS环境的）：

  - 在cookie的生命期限内，在cookie的允许主机和路径范围内的请求

  - 若服务端设置了Secure，访问时用的是https

  - fetch用时需要加上`credentials: 'include'`，即`fetch('https://a.com/api', { credentials: 'include' })`

  - 通过CORS的预检请求（该请求会核查：请求方法的合法性，请求标头的合法性，请求来源的合法性）

  - 服务器端设置的`Set-Cookie`的`SameSite`属性值为`None`，这是可能性很低的（因为浏览器的默认选择是`Lax`：只允许不跨站和顶级导航）

  - > https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/CORS#%E7%AE%80%E5%8D%95%E8%AF%B7%E6%B1%82%E5%92%8C%E9%A2%84%E6%A3%80%E8%AF%B7%E6%B1%82
    >
    > -- from MDN
    >
    > https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Guides/Cookies#samesite_%E5%B1%9E%E6%80%A7
    >
    > -- from MDN

  - 😅这种情况下限制完了还有什么好说的

- 在HTML环境中：

  - 在cookie的生命期限内，在cookie的允许主机和路径范围内的请求
  - 若服务端设置了Secure，访问时用的是https
  - `SameSite`的属性值合适（同上）
  - 😒这种也是直接被默认配置ban了

- 顶级导航：

  - 顶级导航是指浏览器窗口或标签页的主页面被加载或跳转到新URL的过程，就是原页面完全被新页面替代

  - 顶级导航的一些场景：

    - 通过a标签链接（target="_blank"在不同的实现中不一定会被当作顶级导航）

    - 通过地址栏输入新网址

    - 重定向

    - `window.location`，`location.href`等自动跳转的属性和函数

    - form表单提交（GET，POST）到新页面

    - > It would include requests made when the user clicks a link in the top-level browsing context from one site to another, or an assignment to [`document.location`](https://developer.mozilla.org/en-US/docs/Web/API/Document/location), or a [`form`](https://developer.mozilla.org/en-US/docs/Web/HTML/Reference/Elements/form) submission.
      >
      > -- form MDN

  - 在cookie的生命期限内，在cookie的允许主机和路径范围内的请求

  - 若服务端设置了Secure，访问时用的是https

  - `SameSite`的属性值合适（同上）
    😘但是这里有个好消息：因为浏览器的默认`SameSite`是`Lax`，而`Lax`是支持GET顶级导航带cookie的，所以限制没那么死了
    所以我直接给别人来一整个页面自动跳转？（这攻击也太一次性了哈哈🤣）

- 如果真要带上cookie，没准在当前同域下更容易一点呢？（比如当前网站上有什么评论，留言的功能）

#### 3.做个总结：

- 通过浏览官方文档，发现如今对于CSRF的防护已经比较成熟了
- 考虑一下同源站点和GET顶级导航吧🧐

